package com.live.Debugger;

import java.io.BufferedReader;
import java.io.DataInputStream;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayList;

import javafx.application.Application;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;
import javafx.event.ActionEvent;
import javafx.event.EventHandler;
import javafx.fxml.FXMLLoader;
import javafx.scene.Node;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.control.ScrollPane;
import javafx.scene.layout.AnchorPane;
import javafx.scene.layout.HBox;
import javafx.scene.layout.Pane;
import javafx.scene.layout.VBox;
import javafx.stage.Stage;

public class liveDebugging extends Application {
	
	private Parent root = null;
	CodeWindow currentCodeWindow = null;
	//0 represents no line executed, 1st line is 1, current code display list starts from 0 so need to + 1
	int currentExecutionLine = 0; 
	//for testing
	CodeWindow CodeWindow1 = null;
	CodeWindow CodeWindow2 = null;
	int currentWindow = 0;

	public static void main(String[] args) {
			launch(args);
		}
	
	@Override
	public void start(Stage primaryStage) throws IOException {
//		FXMLLoader fxmlLoader = new FXMLLoader();
		root = FXMLLoader.load(getClass().getClassLoader().getResource("LDB_fxml.fxml"));


		CodeWindow testWin = new CodeWindow();
		testWin.setCodeStack(getArray());
		
		addElementToRoot(testWin.getCodeWindow());
		testWin.relocate(20, 10);
		testWin.setSize(400, 180);
		
        
        //testing
        CodeWindow1 = testWin;
        
        //setting code window as currentCodeWindow
        setCurrentCodeWindow(testWin);
        
//-------------------------------
        CodeWindow testWin2 = new CodeWindow();
		testWin2.setCodeStack(getArray());
		
		addElementToRoot(testWin2.getCodeWindow());
		testWin2.relocate(20, 200);
		testWin2.setSize(400, 180);
		
        
        //testing
        CodeWindow2 = testWin2;

//---------------------------------
        Button nextBtn = (Button) getRootAnchorPane().lookup("#PrevButton");
        initializeElementControl();
        
//        Button nextBtn = new Button("Next");
//        Button previousBtn = new Button("Previous");
//        
//        nextBtn.setStyle("-fx-padding: 6 10 6 10;");
//        previousBtn.setStyle("-fx-padding: 6 10 6 10;");
        
//        nextBtn.setOnAction(new EventHandler<ActionEvent>() {
//            @Override public void handle(ActionEvent e) {
//            	
//	            	currentCodeWindow.incrementCurrentExecutionLine();
//	            	//set current line to yellow
//	            	VBox codeStack = currentCodeWindow.getCodeStack();
//	            	codeStack.getChildren().get(currentCodeWindow.getCurrentExecutionLine() - 1).setStyle("-fx-background-color: #FFFF99");
//	
//	                if(currentCodeWindow.getCurrentExecutionLine() > 1)
//	                	//set previous line to green
//	                	codeStack.getChildren().get(currentCodeWindow.getCurrentExecutionLine() - 2).setStyle("-fx-background-color: #98FB98");
//	                
//	                System.out.println(currentCodeWindow.getCurrentExecutionLine());
//            	
//            }
//        });
//        
//        previousBtn.setOnAction(new EventHandler<ActionEvent>() {
//            @Override public void handle(ActionEvent e) {
//            	if(currentCodeWindow.getCurrentExecutionLine() > 1)
//            	{
//            		currentCodeWindow.decrementCurrentExecutionLine();
//            		//set previous line to yellow
//            		VBox codeStack = currentCodeWindow.getCodeStack();
//	            	codeStack.getChildren().get(currentCodeWindow.getCurrentExecutionLine() - 1).setStyle("-fx-background-color: #FFFF99");
//                
//            		//set current line to red
//	            	codeStack.getChildren().get(currentCodeWindow.getCurrentExecutionLine()).setStyle("-fx-background-color: #ECC3BF");
//                
//                	System.out.println(currentCodeWindow.getCurrentExecutionLine() );
//                	
//            	}
//            }
//        });
        
//        HBox controlPane = (HBox)getRootAnchorPane().lookup("#controlPane");
//        controlPane.getChildren().addAll(previousBtn, nextBtn);
		
        //setting button to toggle current code window
        Button toggleBtn = (Button)getRootAnchorPane().lookup("#button");
        toggleBtn.setOnAction(new EventHandler<ActionEvent>() {
        	@Override public void handle(ActionEvent e) 
        		{
        			if(currentWindow == 0)
        			{
        				setCurrentCodeWindow(CodeWindow2);
        				currentWindow = 1;
        			}else
        				
        			{
        				setCurrentCodeWindow(CodeWindow1);
        				currentWindow = 0;
        			}
        		}
        	});
        
		Scene s = new Scene(root);
		primaryStage.setScene(s);
		primaryStage.show();
	}
	
	private AnchorPane getRootAnchorPane()
    {
		AnchorPane pane = (AnchorPane) root.lookup("#AnchorPane");        
        return pane;
    }
	
	private void addElementToRoot(Node node)
    {
		AnchorPane root = getRootAnchorPane();
		root.getChildren().add(node);
    }
	
	//need to find a way to get genric type for parent, for now use pane
    public void addElement(ScrollPane Parent, Node node)
    {
        if (Parent!=null) 
        {
            Parent.setContent(node); 
        }
    }
    
    private ObservableList<HBox> getArray()
    {
    	ObservableList<HBox> vertArray  = FXCollections.observableArrayList();
    	ArrayList<String[]> list = getInputFromFile(); 
    	
    	for(String[] strAry : list)
    	{
	    	HBox hBox = new HBox();
	    	hBox.setStyle("-fx-background-color: #ECC3BF");
	    	for(String string : strAry)
	    	{
	    		Label label = new Label(string);    		
	    		hBox.getChildren().add(label);    		
	    	}
	    	vertArray.add(hBox);
    	}

//        hBox2.setStyle("-fx-background-color: #ECC3BF");
    	return vertArray;
    }
    
    private ArrayList<String[]> getInputFromFile()
    {
    	ArrayList<String[]> list = new ArrayList<String[]>();
    	try{
    		  // Open the file that is the first 
    		  // command line parameter
    		  FileInputStream fstream = new FileInputStream("textfile.txt");
    		  // Get the object of DataInputStream
    		  DataInputStream in = new DataInputStream(fstream);
    		  BufferedReader br = new BufferedReader(new InputStreamReader(in));
    		  String strLine;
    		  //Read File Line By Line
    		  while ((strLine = br.readLine()) != null)   
    		  {
	    		  // Print the content on the console
	    		  //System.out.println (strLine);
	    		  String[] strAry = strLine.split(" ");
	    		  
	    		  list.add(strAry); 
    		  }
    		  //Close the input stream
    		  in.close();

		    }catch (Exception e)
		    {
		    	//Catch exception if any
		    	System.err.println("Error: " + e.getMessage());
		    }
		return list;
    }
    
    private void setCurrentCodeWindow(CodeWindow codeWindow)
    {
    	currentCodeWindow = codeWindow;
    }
    
    private void initializeElementControl()
    {
    	Button nextBtn = (Button) getRootAnchorPane().lookup("#codeWindowNextBtn");
        Button previousBtn = (Button) getRootAnchorPane().lookup("#codeWindowPrevBtn");
        
    	nextBtn.setOnAction(new EventHandler<ActionEvent>() {
            @Override public void handle(ActionEvent e) {
            	
	            	currentCodeWindow.incrementCurrentExecutionLine();
	            	//set current line to yellow
	            	VBox codeStack = currentCodeWindow.getCodeStack();
	            	codeStack.getChildren().get(currentCodeWindow.getCurrentExecutionLine() - 1).setStyle("-fx-background-color: #FFFF99");
	
	                if(currentCodeWindow.getCurrentExecutionLine() > 1)
	                	//set previous line to green
	                	codeStack.getChildren().get(currentCodeWindow.getCurrentExecutionLine() - 2).setStyle("-fx-background-color: #98FB98");
	                
	                System.out.println(currentCodeWindow.getCurrentExecutionLine());
            	
            }
        });
        
        previousBtn.setOnAction(new EventHandler<ActionEvent>() {
            @Override public void handle(ActionEvent e) {
            	if(currentCodeWindow.getCurrentExecutionLine() > 1)
            	{
            		currentCodeWindow.decrementCurrentExecutionLine();
            		//set previous line to yellow
            		VBox codeStack = currentCodeWindow.getCodeStack();
	            	codeStack.getChildren().get(currentCodeWindow.getCurrentExecutionLine() - 1).setStyle("-fx-background-color: #FFFF99");
                
            		//set current line to red
	            	codeStack.getChildren().get(currentCodeWindow.getCurrentExecutionLine()).setStyle("-fx-background-color: #ECC3BF");
                
                	System.out.println(currentCodeWindow.getCurrentExecutionLine() );
                	
            	}
            }
        });
    }
    
	
}
